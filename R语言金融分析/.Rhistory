if (a[i] > 2)
print(a[i])
}
###2.5. 3 é•¿å®½æ ¼å¼çš„è½¬æ?###1ï¼‰stack()å’?unstack()
xx01 <- data.frame(age=c(20,21,20,22,19),per=c(60,50,70,80,90))###äº§ç”Ÿæ•°æ®æ¡?xx01
xx02 <- stack(xx01) ###è½¬æ¢æˆé•¿æ•°æ®æ¡?xx02
xx03 <- data.frame(stunames=c("ç‹ä¸€","å¼ äºŒ","é™ˆä¸‰","æå››","å­™å…­"),age=c(20,21,20,22,19),per=c(60,50,70,80,90)) ###äº§ç”Ÿæ•°æ®æ¡?xx03
xx04 <- stack(xx03,select=-stunames) ###è½¬æ¢æˆé•¿æ•°æ®æ¡†ï¼Œå¿½ç•¥ stunames å˜é‡
xx04
xx05 <- unstack(xx04) ###å°†é•¿æ•°æ®è½¬æ¢æˆå®½æ•°æ®
xx05
##2)melt()å‡½æ•°
xx10 <- data.frame(stunames=c("ç‹ä¸€","å¼ äºŒ","é™ˆä¸‰","æå››","å­™å…­"),age=c(20,21,20,22,19),per=c(60,50,70,80,90)) ###äº§ç”Ÿæ•°æ®æ¡?xx10 ###è¯»å–æ•°æ®
install.packages("reshape") ###å®‰è£… reshape åŒ?xx101 <- melt(xx10,id.vars="stunames") ###å°†å®½æ•°æ®è½¬æ¢æˆé•¿æ•°æ®
library("reshape")
xx101 <- melt(xx10,id.vars="stunames") ###å°†å®½æ•°æ®è½¬æ¢æˆé•¿æ•°æ®
xx101
xx10 ###è¯»å–æ•°æ®
###å°†æ•°ç»„è½¬æ¢æˆæ•°æ®æ¡?xx102 <- array(1:3, dim=c(2,2,2)) ###äº§ç”Ÿä¸€ä¸ªæ•°ç»?xx102 ###è¯»å–æ•°æ®
xx103 <- melt(xx102,varnames=LETTERS[24:26],value.name="Val") ###æº¶è§£æ•°ç»„,å¹¶å®šä¹‰åˆ—å?xx103 ###è¯»å–æ•°æ®
xx104 <- melt(xx10,id.vars="stunames") ###å°†å®½æ•°æ®è½¬æ¢æˆé•¿æ•°æ®
xx104 ###è¯»å–æ•°æ®
###è¿˜åŸ
xx104 <- melt(xx10,id.vars="stunames") ###å°†å®½æ•°æ®è½¬æ¢æˆé•¿æ•°æ®
xx104 ###è¯»å–æ•°æ®
xx105 <- cast(xx104) ###è¿˜åŸæ•°æ®æ¡?xx105 ###è¯»å–æ•°æ®
##3)reshape()å‡½æ•°
library("RODBC") ###è½½å…¥ RODBC åŒ?##3)reshape()å‡½æ•°
install.packages("RODBC")
library("RODBC") ###è½½å…¥ RODBC åŒ?xx253 <- read.csv("D:/R data class/xx253.csv",stringsAsFactors=F) ###è¯»å–.csv æ–‡ä»¶
#é—®é¢˜ï¼šå¤„ç†æˆ‘ 1992.xlsx çš„æ•°æ®é—®é¢?library(reshape2)
AG6.1992 <- read.csv("C:/Users/terry/Documents/æˆ‘çˆ±å­¦ä¹ /ç»Ÿè®¡è½¯ä»¶/R/1992.csv",stringsAsFactors = F)
AG6.1992.1 <- melt(AG6.1992,id="Commodity.Code")
View(AG6.1992)
AG6.1992.2 <- dcast(AG6.1992.1,
Commodity.Code~variable,
function(x)sum(x,na.rm=T))
View(AG6.1992.1)
View(AG6.1992.2)
install.packages("caret")
library("caret")
dat0 = read.csv('C:/Users/terry/Documents/æˆ‘çˆ±å­¦ä¹ /ç»Ÿè®¡è½¯ä»¶/R/R_code/Rä¸åƒå¯»ï¼ˆä»£ç +æ•°æ®ï¼?ç¬¬äº”ç«?Rè¯­è¨€ä¸æœºå™¨å­¦ä¹?5.1 æœºå™¨å­¦ä¹ /æ¦‚è¿°ç›¸äº²æ•°æ®.csv', fileEncoding = "UTF-8")
dat0 = read.csv("C:/Users/terry/Documents/æˆ‘çˆ±å­¦ä¹ /ç»Ÿè®¡è½¯ä»¶/R/R_code/Rä¸åƒå¯»ï¼ˆä»£ç +æ•°æ®ï¼?ç¬¬äº”ç«?Rè¯­è¨€ä¸æœºå™¨å­¦ä¹?5.1 æœºå™¨å­¦ä¹ /æ¦‚è¿°ç›¸äº²æ•°æ®.csv", fileEncoding = "UTF-8")
dat0 = read.csv("C:/Users/terry/Documents/æˆ‘çˆ±å­¦ä¹ /ç»Ÿè®¡è½¯ä»¶/R/R_code/Rä¸åƒå¯»ï¼ˆä»£ç +æ•°æ®ï¼?ç¬¬äº”ç«?Rè¯­è¨€ä¸æœºå™¨å­¦ä¹?5.1 æœºå™¨å­¦ä¹ æ¦‚è¿°/ç›¸äº²æ•°æ®.csv", fileEncoding = "UTF-8")
head(dat0)
### 1.æ•°æ®é¢„å¤„ç†åŠæ•°æ®åˆ†å‰² ###
## (1) ç¼ºå¤±å€¼å¤„ç?##
nrow(dat0)
dat = na.omit(dat0)
nrow(dat)
## (2) å°†å®šæ€§å˜é‡è½¬æ¢ä¸ºå› å­æ€§å˜é‡?##
# è½¬æ¢æ•°æ®ç±»å‹
dat$å†³å®š = factor(dat$å†³å®š,
levels = c(0, 1),
labels = c("æ‹’ç»", "æ¥æ”¶"))
dat$æ€§åˆ« = factor(dat$æ€§åˆ«,
levels = c(0, 1),
labels = c("å¥?, "ç”?))
dat$ç§æ— = factor(dat$ç§æ—,
levels = c(1, 2, 3, 4, 5, 6),
labels = c("éæ´²è£?, "æ¬§æ´²è£?, "æ‹‰ä¸è£?, "äºšè£”", "å°ç¬¬å®‰åœŸè‘?, "å…¶ä»–"))
dat$ä»äº‹é¢†åŸŸ = factor(dat$ä»äº‹é¢†åŸŸ, levels = 1:18,
labels = c("æ³•å¾‹", "æ•°å­¦", "ç¤¾ä¼šç§‘å­¦æˆ–å¿ƒç†å­¦",
"åŒ»å­¦æˆ–è¯ç‰©å­¦æˆ–ç”Ÿç‰©æŠ€æœ?, "å·¥ç¨‹å­?, "å†™ä½œæˆ–æ–°é—?,
"å†å²æˆ–å®—æ•™æˆ–å“²å­¦", "å•†ä¸šæˆ–ç»æµæˆ–é‡‘è", "æ•™è‚²æˆ–å­¦æœ?,
"ç”Ÿç‰©ç§‘å­¦æˆ–åŒ–å­¦æˆ–ç‰©ç†", "ç¤¾ä¼šå·¥ä½œ", "å¤§å­¦åœ¨è¯»æˆ–æœªæ‹©æ–¹å?,
"æ”¿æ²»å­¦æˆ–å›½é™…äº‹åŠ¡", "ç”µå½±", "è‰ºæœ¯ç®¡ç†",
"è¯­è¨€", "å»ºç­‘å­?, "å…¶ä»–"))
dat$å¯¹æ–¹å†³å®š = factor(dat$å¯¹æ–¹å†³å®š,
levels = c(0, 1),
labels = c("æ‹’ç»", "æ¥æ”¶"))
dat$å¯¹æ–¹ç§æ— = factor(dat$å¯¹æ–¹ç§æ—,
levels = c(1, 2, 3, 4, 5,6),
labels = c("éæ´²è£?, "æ¬§æ´²è£?, "æ‹‰ä¸è£?, "äºšè£”", "å°ç¬¬å®‰åœŸè‘?, "å…¶ä»–"))
dat$æ˜¯å¦åŒä¸€ç§æ— = factor(dat$æ˜¯å¦åŒä¸€ç§æ—,
levels = c(0, 1),
labels = c("éåŒä¸€ç§æ—", "åŒä¸€ç§æ—"))
## (3) æ•°æ®åˆ’åˆ†ä¸ºè®­ç»ƒé›†å’Œæµ‹è¯•é›† ##
# è®¾ç½®éšæœºç§å­
set.seed(1234)
# å°†æ•°æ®é›†çš?0%åˆ’åˆ†ä¸ºè®­ç»ƒé›†ï¼?0%åˆ’åˆ†ä¸ºæµ‹è¯•é›†
trainIndex = createDataPartition(dat$å†³å®š, p = .8,
list = FALSE,
times = 1)
# createDataPartitionä¼šè‡ªåŠ¨ä»yçš„å„ä¸ªleveléšæœºå–å‡ºç­‰æ¯”ä¾‹çš„æ•°æ®æ¥ï¼Œç»„æˆè®­ç»ƒé›?å¯ç†è§£ä¸ºåˆ†å±‚æŠ½æ ·ï¼?datTrain = dat[trainIndex, ]
# è®­ç»ƒé›?datTest = dat[-trainIndex, ]
# æµ‹è¯•é›?table(dat$å†³å®š) / nrow(dat)  # å…¨é›†ä¸Šå› å˜é‡å„ä¸ªæ°´å¹³çš„æ¯”ä¾?table(datTrain$å†³å®š) / nrow(datTrain)  # è®­ç»ƒé›†ä¸Šå› å˜é‡å„ä¸ªæ°´å¹³çš„æ¯”ä¾‹
table(datTest$å†³å®š) / nrow(datTest)  # æµ‹è¯•é›†ä¸Šå› å˜é‡å„ä¸ªæ°´å¹³çš„æ¯”ä¾‹
## (4) æ ‡å‡†åŒ–å¤„ç?##
preProcValues = preProcess(datTrain, method = c("center", "scale"))
trainTransformed = predict(preProcValues, datTrain)
testTransformed = predict(preProcValues, datTest)
## å°è£…æ³?rfe: Recursive feature selection ##
subsets = c(2, 5, 10, 15, 20)
# è¦é€‰æ‹©çš„å˜é‡ä¸ªæ•?ctrl = rfeControl(functions = rfFuncs, method = "cv")
# é¦–å…ˆå®šä¹‰æ§åˆ¶å‚æ•°ï¼Œfunctionsæ˜¯ç¡®å®šç”¨ä»€ä¹ˆæ ·çš„æ¨¡å‹è¿›è¡Œè‡ªå˜é‡æ’åºï¼Œæœ¬ä¾‹é€‰æ‹©çš„æ¨¡å‹æ˜¯éšæœºæ£®æ—
# æ ¹æ®ç›®æ ‡å‡½æ•°ï¼ˆé€šå¸¸æ˜¯é¢„æµ‹æ•ˆæœè¯„åˆ†ï¼‰ï¼Œæ¯æ¬¡é€‰æ‹©è‹¥å¹²ç‰¹å¾ã€?# methodæ˜¯ç¡®å®šç”¨ä»€ä¹ˆæ ·çš„æŠ½æ ·æ–¹æ³•ï¼Œæœ¬ä¾‹ä½¿ç”¨cvï¼Œå³äº¤å‰æ£€éª?x = trainTransformed [, -which( colnames(trainTransformed ) %in% "å†³å®š")]
y = trainTransformed [, "å†³å®š"]
Profile = rfe(x, y, sizes = subsets, rfeControl = ctrl)
Profile$optVariables  # ç­›é€‰å‡º15ä¸ªå˜é‡?Profile = rfe(x, y, sizes = subsets, rfeControl = ctrl)
?rfe
?rfe
Profile = rfe(x, y, sizes = subsets, rfeControl = ctrl)
Profile = rfe(x,y,sizes = subsets, rfeControl =  = ctrl)
Profile = rfe(x,y,sizes = subsets, rfeControl = ctrl)
install.packages('e1071', dependencies=TRUE)
Profile = rfe(x,y,sizes = subsets, rfeControl = ctrl)
q()
library("e1071")
Profile = rfe(x,y,sizes = subsets, rfeControl = ctrl)
library("caret")
Profile = rfe(x,y,sizes = subsets, rfeControl = ctrl)
library("caret")
dat0 = read.csv("C:/Users/terry/Documents/æˆ‘çˆ±å­¦ä¹ /ç»Ÿè®¡è½¯ä»¶/R/R_code/Rä¸åƒå¯»ï¼ˆä»£ç +æ•°æ®ï¼‰/ç¬¬äº”ç«  Rè¯­è¨€ä¸æœºå™¨å­¦ä¹ /5.1 æœºå™¨å­¦ä¹ æ¦‚è¿°/ç›¸äº²æ•°æ®.csv", fileEncoding = "UTF-8")
head(dat0)
### 1.æ•°æ®é¢„å¤„ç†åŠæ•°æ®åˆ†å‰² ###
## (1) ç¼ºå¤±å€¼å¤„ç† ##
nrow(dat0)
dat = na.omit(dat0)
nrow(dat)
## (2) å°†å®šæ€§å˜é‡è½¬æ¢ä¸ºå› å­æ€§å˜é‡ ##
# è½¬æ¢æ•°æ®ç±»å‹
dat$å†³å®š = factor(dat$å†³å®š,
levels = c(0, 1),
labels = c("æ‹’ç»", "æ¥æ”¶"))
dat$æ€§åˆ« = factor(dat$æ€§åˆ«,
levels = c(0, 1),
labels = c("å¥³", "ç”·"))
dat$ç§æ— = factor(dat$ç§æ—,
levels = c(1, 2, 3, 4, 5, 6),
labels = c("éæ´²è£”", "æ¬§æ´²è£”", "æ‹‰ä¸è£”", "äºšè£”", "å°ç¬¬å®‰åœŸè‘—", "å…¶ä»–"))
dat$ä»äº‹é¢†åŸŸ = factor(dat$ä»äº‹é¢†åŸŸ, levels = 1:18,
levels = c(0, 1),                   labels = c("æ³•å¾‹", "æ•°å­¦", "ç¤¾ä¼šç§‘å­¦æˆ–å¿ƒç†å­¦",
"åŒ»å­¦æˆ–è¯ç‰©å­¦æˆ–ç”Ÿç‰©æŠ€æœ¯", "å·¥ç¨‹å­¦", "å†™ä½œæˆ–æ–°é—»",
"å†å²æˆ–å®—æ•™æˆ–å“²å­¦", "å•†ä¸šæˆ–ç»æµæˆ–é‡‘è", "æ•™è‚²æˆ–å­¦æœ¯",
"ç”Ÿç‰©ç§‘å­¦æˆ–åŒ–å­¦æˆ–ç‰©ç†", "ç¤¾ä¼šå·¥ä½œ", "å¤§å­¦åœ¨è¯»æˆ–æœªæ‹©æ–¹å‘",
"æ”¿æ²»å­¦æˆ–å›½é™…äº‹åŠ¡", "ç”µå½±", "è‰ºæœ¯ç®¡ç†",
"è¯­è¨€", "å»ºç­‘å­¦", "å…¶ä»–"))
dat$å¯¹æ–¹å†³å®š = factor(dat$å¯¹æ–¹å†³å®š,
labels = c("æ‹’ç»", "æ¥æ”¶"))
dat$å¯¹æ–¹ç§æ— = factor(dat$å¯¹æ–¹ç§æ—,
levels = c(1, 2, 3, 4, 5,6),
labels = c("éæ´²è£”", "æ¬§æ´²è£”", "æ‹‰ä¸è£”", "äºšè£”", "å°ç¬¬å®‰åœŸè‘—", "å…¶ä»–"))
dat$æ˜¯å¦åŒä¸€ç§æ— = factor(dat$æ˜¯å¦åŒä¸€ç§æ—,
levels = c(0, 1),
labels = c("éåŒä¸€ç§æ—", "åŒä¸€ç§æ—"))
## (3) æ•°æ®åˆ’åˆ†ä¸ºè®­ç»ƒé›†å’Œæµ‹è¯•é›† ##
# è®¾ç½®éšæœºç§å­
set.seed(1234)
# å°†æ•°æ®é›†çš„80%åˆ’åˆ†ä¸ºè®­ç»ƒé›†ï¼Œ20%åˆ’åˆ†ä¸ºæµ‹è¯•é›†
trainIndex = createDataPartition(dat$å†³å®š, p = .8,
list = FALSE,
times = 1)
# createDataPartitionä¼šè‡ªåŠ¨ä»yçš„å„ä¸ªleveléšæœºå–å‡ºç­‰æ¯”ä¾‹çš„æ•°æ®æ¥ï¼Œç»„æˆè®­ç»ƒé›†,å¯ç†è§£ä¸ºåˆ†å±‚æŠ½æ ·ï¼›
datTrain = dat[trainIndex, ]
# è®­ç»ƒé›†
datTest = dat[-trainIndex, ]
# æµ‹è¯•é›†
table(dat$å†³å®š) / nrow(dat)  # å…¨é›†ä¸Šå› å˜é‡å„ä¸ªæ°´å¹³çš„æ¯”ä¾‹
table(datTrain$å†³å®š) / nrow(datTrain)  # è®­ç»ƒé›†ä¸Šå› å˜é‡å„ä¸ªæ°´å¹³çš„æ¯”ä¾‹
table(datTest$å†³å®š) / nrow(datTest)  # æµ‹è¯•é›†ä¸Šå› å˜é‡å„ä¸ªæ°´å¹³çš„æ¯”ä¾‹
## (4) æ ‡å‡†åŒ–å¤„ç† ##
preProcValues = preProcess(datTrain, method = c("center", "scale"))
trainTransformed = predict(preProcValues, datTrain)
testTransformed = predict(preProcValues, datTest)
# åˆ©ç”¨è®­ç»ƒé›†çš„å‡å€¼å’Œæ–¹å·®å¯¹æµ‹è¯•é›†è¿›è¡Œæ ‡å‡†åŒ–
### 2.å˜é‡é€‰æ‹© ###
## å°è£…æ³• rfe: Recursive feature selection ##
subsets = c(2, 5, 10, 15, 20)
# è¦é€‰æ‹©çš„å˜é‡ä¸ªæ•°
ctrl = rfeControl(functions = rfFuncs, method = "cv")
# é¦–å…ˆå®šä¹‰æ§åˆ¶å‚æ•°ï¼Œfunctionsæ˜¯ç¡®å®šç”¨ä»€ä¹ˆæ ·çš„æ¨¡å‹è¿›è¡Œè‡ªå˜é‡æ’åºï¼Œæœ¬ä¾‹é€‰æ‹©çš„æ¨¡å‹æ˜¯éšæœºæ£®æ—
# æ ¹æ®ç›®æ ‡å‡½æ•°ï¼ˆé€šå¸¸æ˜¯é¢„æµ‹æ•ˆæœè¯„åˆ†ï¼‰ï¼Œæ¯æ¬¡é€‰æ‹©è‹¥å¹²ç‰¹å¾ã€‚
# methodæ˜¯ç¡®å®šç”¨ä»€ä¹ˆæ ·çš„æŠ½æ ·æ–¹æ³•ï¼Œæœ¬ä¾‹ä½¿ç”¨cvï¼Œå³äº¤å‰æ£€éªŒ
x = trainTransformed [, -which( colnames(trainTransformed ) %in% "å†³å®š")]
y = trainTransformed [, "å†³å®š"]
library("e1071")
Profile = rfe(x,y,sizes = subsets, rfeControl = ctrl)
install.packages("caret")
library("caret")
dat0 = read.csv("C:/Users/terry/Documents/æˆ‘çˆ±å­¦ä¹ /ç»Ÿè®¡è½¯ä»¶/R/R_code/Rä¸åƒå¯»ï¼ˆä»£ç +æ•°æ®ï¼‰/ç¬¬äº”ç«  Rè¯­è¨€ä¸æœºå™¨å­¦ä¹ /5.1 æœºå™¨å­¦ä¹ æ¦‚è¿°/ç›¸äº²æ•°æ®.csv", fileEncoding = "UTF-8")
head(dat0)
### 1.æ•°æ®é¢„å¤„ç†åŠæ•°æ®åˆ†å‰² ###
## (1) ç¼ºå¤±å€¼å¤„ç† ##
nrow(dat0)
dat = na.omit(dat0)
nrow(dat)
## (2) å°†å®šæ€§å˜é‡è½¬æ¢ä¸ºå› å­æ€§å˜é‡ ##
# è½¬æ¢æ•°æ®ç±»å‹
dat$å†³å®š = factor(dat$å†³å®š,
levels = c(0, 1),
labels = c("æ‹’ç»", "æ¥æ”¶"))
dat$æ€§åˆ« = factor(dat$æ€§åˆ«,
levels = c(0, 1),
labels = c("å¥³", "ç”·"))
dat$ç§æ— = factor(dat$ç§æ—,
levels = c(1, 2, 3, 4, 5, 6),
labels = c("éæ´²è£”", "æ¬§æ´²è£”", "æ‹‰ä¸è£”", "äºšè£”", "å°ç¬¬å®‰åœŸè‘—", "å…¶ä»–"))
dat$ä»äº‹é¢†åŸŸ = factor(dat$ä»äº‹é¢†åŸŸ, levels = 1:18,
levels = c(0, 1),                   labels = c("æ³•å¾‹", "æ•°å­¦", "ç¤¾ä¼šç§‘å­¦æˆ–å¿ƒç†å­¦",
"åŒ»å­¦æˆ–è¯ç‰©å­¦æˆ–ç”Ÿç‰©æŠ€æœ¯", "å·¥ç¨‹å­¦", "å†™ä½œæˆ–æ–°é—»",
"å†å²æˆ–å®—æ•™æˆ–å“²å­¦", "å•†ä¸šæˆ–ç»æµæˆ–é‡‘è", "æ•™è‚²æˆ–å­¦æœ¯",
"ç”Ÿç‰©ç§‘å­¦æˆ–åŒ–å­¦æˆ–ç‰©ç†", "ç¤¾ä¼šå·¥ä½œ", "å¤§å­¦åœ¨è¯»æˆ–æœªæ‹©æ–¹å‘",
"æ”¿æ²»å­¦æˆ–å›½é™…äº‹åŠ¡", "ç”µå½±", "è‰ºæœ¯ç®¡ç†",
"è¯­è¨€", "å»ºç­‘å­¦", "å…¶ä»–"))
dat$ä»äº‹é¢†åŸŸ = factor(dat$ä»äº‹é¢†åŸŸ, levels = 1:18,
levels = c(0, 1),labels = c("æ³•å¾‹", "æ•°å­¦", "ç¤¾ä¼šç§‘å­¦æˆ–å¿ƒç†å­¦",
"åŒ»å­¦æˆ–è¯ç‰©å­¦æˆ–ç”Ÿç‰©æŠ€æœ¯", "å·¥ç¨‹å­¦", "å†™ä½œæˆ–æ–°é—»",
"å†å²æˆ–å®—æ•™æˆ–å“²å­¦", "å•†ä¸šæˆ–ç»æµæˆ–é‡‘è", "æ•™è‚²æˆ–å­¦æœ¯",
"ç”Ÿç‰©ç§‘å­¦æˆ–åŒ–å­¦æˆ–ç‰©ç†", "ç¤¾ä¼šå·¥ä½œ", "å¤§å­¦åœ¨è¯»æˆ–æœªæ‹©æ–¹å‘",
"æ”¿æ²»å­¦æˆ–å›½é™…äº‹åŠ¡", "ç”µå½±", "è‰ºæœ¯ç®¡ç†",
"è¯­è¨€", "å»ºç­‘å­¦", "å…¶ä»–"))
dat$ä»äº‹é¢†åŸŸ = factor(dat$ä»äº‹é¢†åŸŸ, levels = 1:18,
levels = c(0, 1),labels = c("æ³•å¾‹", "æ•°å­¦", "ç¤¾ä¼šç§‘å­¦æˆ–å¿ƒç†å­¦",
"åŒ»å­¦æˆ–è¯ç‰©å­¦æˆ–ç”Ÿç‰©æŠ€æœ¯", "å·¥ç¨‹å­¦", "å†™ä½œæˆ–æ–°é—»",
"å†å²æˆ–å®—æ•™æˆ–å“²å­¦", "å•†ä¸šæˆ–ç»æµæˆ–é‡‘è", "æ•™è‚²æˆ–å­¦æœ¯",
"ç”Ÿç‰©ç§‘å­¦æˆ–åŒ–å­¦æˆ–ç‰©ç†", "ç¤¾ä¼šå·¥ä½œ", "å¤§å­¦åœ¨è¯»æˆ–æœªæ‹©æ–¹å‘",
"æ”¿æ²»å­¦æˆ–å›½é™…äº‹åŠ¡", "ç”µå½±", "è‰ºæœ¯ç®¡ç†",
"è¯­è¨€", "å»ºç­‘å­¦", "å…¶ä»–"))
dat$ä»äº‹é¢†åŸŸ = factor(dat$ä»äº‹é¢†åŸŸ, levels = 1:18,
labels = c("æ³•å¾‹", "æ•°å­¦", "ç¤¾ä¼šç§‘å­¦æˆ–å¿ƒç†å­¦",
"åŒ»å­¦æˆ–è¯ç‰©å­¦æˆ–ç”Ÿç‰©æŠ€æœ¯", "å·¥ç¨‹å­¦", "å†™ä½œæˆ–æ–°é—»",
"å†å²æˆ–å®—æ•™æˆ–å“²å­¦", "å•†ä¸šæˆ–ç»æµæˆ–é‡‘è", "æ•™è‚²æˆ–å­¦æœ¯",
"ç”Ÿç‰©ç§‘å­¦æˆ–åŒ–å­¦æˆ–ç‰©ç†", "ç¤¾ä¼šå·¥ä½œ", "å¤§å­¦åœ¨è¯»æˆ–æœªæ‹©æ–¹å‘",
"æ”¿æ²»å­¦æˆ–å›½é™…äº‹åŠ¡", "ç”µå½±", "è‰ºæœ¯ç®¡ç†",
"è¯­è¨€", "å»ºç­‘å­¦", "å…¶ä»–"))
dat$å¯¹æ–¹å†³å®š = factor(dat$å¯¹æ–¹å†³å®š, labels = c("æ‹’ç»", "æ¥æ”¶"))
dat$å¯¹æ–¹ç§æ— = factor(dat$å¯¹æ–¹ç§æ—,
levels = c(1, 2, 3, 4, 5,6),
labels = c("éæ´²è£”", "æ¬§æ´²è£”", "æ‹‰ä¸è£”", "äºšè£”", "å°ç¬¬å®‰åœŸè‘—", "å…¶ä»–"))
dat$æ˜¯å¦åŒä¸€ç§æ— = factor(dat$æ˜¯å¦åŒä¸€ç§æ—,
levels = c(0, 1),
labels = c("éåŒä¸€ç§æ—", "åŒä¸€ç§æ—"))
## (3) æ•°æ®åˆ’åˆ†ä¸ºè®­ç»ƒé›†å’Œæµ‹è¯•é›† ##
# è®¾ç½®éšæœºç§å­
set.seed(1234)
# å°†æ•°æ®é›†çš„80%åˆ’åˆ†ä¸ºè®­ç»ƒé›†ï¼Œ20%åˆ’åˆ†ä¸ºæµ‹è¯•é›†
trainIndex = createDataPartition(dat$å†³å®š, p = .8,
list = FALSE,
times = 1)
# createDataPartitionä¼šè‡ªåŠ¨ä»yçš„å„ä¸ªleveléšæœºå–å‡ºç­‰æ¯”ä¾‹çš„æ•°æ®æ¥ï¼Œç»„æˆè®­ç»ƒé›†,å¯ç†è§£ä¸ºåˆ†å±‚æŠ½æ ·ï¼›
datTrain = dat[trainIndex, ]
# è®­ç»ƒé›†
datTest = dat[-trainIndex, ]
# æµ‹è¯•é›†
table(dat$å†³å®š) / nrow(dat)  # å…¨é›†ä¸Šå› å˜é‡å„ä¸ªæ°´å¹³çš„æ¯”ä¾‹
table(datTrain$å†³å®š) / nrow(datTrain)  # è®­ç»ƒé›†ä¸Šå› å˜é‡å„ä¸ªæ°´å¹³çš„æ¯”ä¾‹
table(datTest$å†³å®š) / nrow(datTest)  # æµ‹è¯•é›†ä¸Šå› å˜é‡å„ä¸ªæ°´å¹³çš„æ¯”ä¾‹
## (4) æ ‡å‡†åŒ–å¤„ç† ##
preProcValues = preProcess(datTrain, method = c("center", "scale"))
trainTransformed = predict(preProcValues, datTrain)
testTransformed = predict(preProcValues, datTest)
## å°è£…æ³• rfe: Recursive feature selection ##
subsets = c(2, 5, 10, 15, 20)
# è¦é€‰æ‹©çš„å˜é‡ä¸ªæ•°
ctrl = rfeControl(functions = rfFuncs, method = "cv")
# é¦–å…ˆå®šä¹‰æ§åˆ¶å‚æ•°ï¼Œfunctionsæ˜¯ç¡®å®šç”¨ä»€ä¹ˆæ ·çš„æ¨¡å‹è¿›è¡Œè‡ªå˜é‡æ’åºï¼Œæœ¬ä¾‹é€‰æ‹©çš„æ¨¡å‹æ˜¯éšæœºæ£®æ—
# æ ¹æ®ç›®æ ‡å‡½æ•°ï¼ˆé€šå¸¸æ˜¯é¢„æµ‹æ•ˆæœè¯„åˆ†ï¼‰ï¼Œæ¯æ¬¡é€‰æ‹©è‹¥å¹²ç‰¹å¾ã€‚
# methodæ˜¯ç¡®å®šç”¨ä»€ä¹ˆæ ·çš„æŠ½æ ·æ–¹æ³•ï¼Œæœ¬ä¾‹ä½¿ç”¨cvï¼Œå³äº¤å‰æ£€éªŒ
x = trainTransformed [, -which( colnames(trainTransformed ) %in% "å†³å®š")]
y = trainTransformed [, "å†³å®š"]
library("e1071")
Profile = rfe(x,y,sizes = subsets, rfeControl = ctrl)
Profile$optVariables  # ç­›é€‰å‡º15ä¸ªå˜é‡
### 3.æ¨¡å‹è®­ç»ƒåŠè°ƒå‚ ###
dat.train = trainTransformed[, c(Profile$optVariables, "å†³å®š")]
dat.test = testTransformed[, c(Profile$optVariables, "å†³å®š")]
## éšæœºæ£®æ— ##
set.seed(1234)
gbmFit1 = train(å†³å®š ~., data = dat.train, method = "rf")
# ç”¨äºè®­ç»ƒæ¨¡å‹
importance = varImp(gbmFit1, scale = FALSE)
# å¾—åˆ°å„ä¸ªå˜é‡çš„é‡è¦æ€§
plot(importance, xlab = "é‡è¦æ€§")
### 4.æ¨¡å‹é¢„æµ‹åŠè¯„ä»· ###
data.predict = predict(gbmFit1, newdata = dat.test)
confusionMatrix(data.predict, dat.test$å†³å®š)
1
# ç”¨äºè®­ç»ƒæ¨¡å‹
importance = varImp(gbmFit1, scale = FALSE)
# å¾—åˆ°å„ä¸ªå˜é‡çš„é‡è¦æ€§
plot(importance, xlab = "é‡è¦æ€§")
setwd("C:/æœºå™¨å­¦ä¹ ")
library("caret")
dat0 = read.csv("ç›¸äº²æ•°æ®.csv", fileEncoding = "UTF-8")
head(dat0)
### 1.æ•°æ®é¢„å¤„ç†åŠæ•°æ®åˆ†å‰² ###
## (1) ç¼ºå¤±å€¼å¤„ç† ##
nrow(dat0)
dat = na.omit(dat0)
nrow(dat)
## (2) å°†å®šæ€§å˜é‡è½¬æ¢ä¸ºå› å­æ€§å˜é‡ ##
# è½¬æ¢æ•°æ®ç±»å‹
dat$å†³å®š = factor(dat$å†³å®š,
levels = c(0, 1),
labels = c("æ‹’ç»", "æ¥æ”¶"))
dat$æ€§åˆ« = factor(dat$æ€§åˆ«,
levels = c(0, 1),
labels = c("å¥³", "ç”·"))
dat$ç§æ— = factor(dat$ç§æ—,
levels = c(1, 2, 3, 4, 5, 6),
labels = c("éæ´²è£”", "æ¬§æ´²è£”", "æ‹‰ä¸è£”", "äºšè£”", "å°ç¬¬å®‰åœŸè‘—", "å…¶ä»–"))
dat$ä»äº‹é¢†åŸŸ = factor(dat$ä»äº‹é¢†åŸŸ, levels = 1:18,
labels = c("æ³•å¾‹", "æ•°å­¦", "ç¤¾ä¼šç§‘å­¦æˆ–å¿ƒç†å­¦",
"åŒ»å­¦æˆ–è¯ç‰©å­¦æˆ–ç”Ÿç‰©æŠ€æœ¯", "å·¥ç¨‹å­¦", "å†™ä½œæˆ–æ–°é—»",
"å†å²æˆ–å®—æ•™æˆ–å“²å­¦", "å•†ä¸šæˆ–ç»æµæˆ–é‡‘è", "æ•™è‚²æˆ–å­¦æœ¯",
"ç”Ÿç‰©ç§‘å­¦æˆ–åŒ–å­¦æˆ–ç‰©ç†", "ç¤¾ä¼šå·¥ä½œ", "å¤§å­¦åœ¨è¯»æˆ–æœªæ‹©æ–¹å‘",
"æ”¿æ²»å­¦æˆ–å›½é™…äº‹åŠ¡", "ç”µå½±", "è‰ºæœ¯ç®¡ç†",
"è¯­è¨€", "å»ºç­‘å­¦", "å…¶ä»–"))
dat$å¯¹æ–¹å†³å®š = factor(dat$å¯¹æ–¹å†³å®š, labels = c("æ‹’ç»", "æ¥æ”¶"))
dat$å¯¹æ–¹ç§æ— = factor(dat$å¯¹æ–¹ç§æ—,
levels = c(1, 2, 3, 4, 5,6),
labels = c("éæ´²è£”", "æ¬§æ´²è£”", "æ‹‰ä¸è£”", "äºšè£”", "å°ç¬¬å®‰åœŸè‘—", "å…¶ä»–"))
dat$æ˜¯å¦åŒä¸€ç§æ— = factor(dat$æ˜¯å¦åŒä¸€ç§æ—,
levels = c(0, 1),
labels = c("éåŒä¸€ç§æ—", "åŒä¸€ç§æ—"))
## (3) æ•°æ®åˆ’åˆ†ä¸ºè®­ç»ƒé›†å’Œæµ‹è¯•é›† ##
# è®¾ç½®éšæœºç§å­
set.seed(1234)
# å°†æ•°æ®é›†çš„80%åˆ’åˆ†ä¸ºè®­ç»ƒé›†ï¼Œ20%åˆ’åˆ†ä¸ºæµ‹è¯•é›†
trainIndex = createDataPartition(dat$å†³å®š, p = .8,
list = FALSE,
times = 1)
# createDataPartitionä¼šè‡ªåŠ¨ä»yçš„å„ä¸ªleveléšæœºå–å‡ºç­‰æ¯”ä¾‹çš„æ•°æ®æ¥ï¼Œç»„æˆè®­ç»ƒé›†,å¯ç†è§£ä¸ºåˆ†å±‚æŠ½æ ·ï¼›
datTrain = dat[trainIndex, ]
# è®­ç»ƒé›†
datTest = dat[-trainIndex, ]
# æµ‹è¯•é›†
table(dat$å†³å®š) / nrow(dat)  # å…¨é›†ä¸Šå› å˜é‡å„ä¸ªæ°´å¹³çš„æ¯”ä¾‹
table(datTrain$å†³å®š) / nrow(datTrain)  # è®­ç»ƒé›†ä¸Šå› å˜é‡å„ä¸ªæ°´å¹³çš„æ¯”ä¾‹
table(datTest$å†³å®š) / nrow(datTest)  # æµ‹è¯•é›†ä¸Šå› å˜é‡å„ä¸ªæ°´å¹³çš„æ¯”ä¾‹
## (4) æ ‡å‡†åŒ–å¤„ç† ##
preProcValues = preProcess(datTrain, method = c("center", "scale"))
trainTransformed = predict(preProcValues, datTrain)
testTransformed = predict(preProcValues, datTest)
## (3) æ•°æ®åˆ’åˆ†ä¸ºè®­ç»ƒé›†å’Œæµ‹è¯•é›† ##
# è®¾ç½®éšæœºç§å­
set.seed(1234)
# å°†æ•°æ®é›†çš„80%åˆ’åˆ†ä¸ºè®­ç»ƒé›†ï¼Œ20%åˆ’åˆ†ä¸ºæµ‹è¯•é›†
trainIndex = createDataPartition(dat$å†³å®š, p = .8,
list = FALSE,
times = 1)
# createDataPartitionä¼šè‡ªåŠ¨ä»yçš„å„ä¸ªleveléšæœºå–å‡ºç­‰æ¯”ä¾‹çš„æ•°æ®æ¥ï¼Œç»„æˆè®­ç»ƒé›†,å¯ç†è§£ä¸ºåˆ†å±‚æŠ½æ ·ï¼›
datTrain = dat[trainIndex, ]
# è®­ç»ƒé›†
datTest = dat[-trainIndex, ]
# æµ‹è¯•é›†
table(dat$å†³å®š) / nrow(dat)  # å…¨é›†ä¸Šå› å˜é‡å„ä¸ªæ°´å¹³çš„æ¯”ä¾‹
table(datTrain$å†³å®š) / nrow(datTrain)  # è®­ç»ƒé›†ä¸Šå› å˜é‡å„ä¸ªæ°´å¹³çš„æ¯”ä¾‹
table(datTest$å†³å®š) / nrow(datTest)  # æµ‹è¯•é›†ä¸Šå› å˜é‡å„ä¸ªæ°´å¹³çš„æ¯”ä¾‹
## (4) æ ‡å‡†åŒ–å¤„ç† ##
preProcValues = preProcess(datTrain, method = c("center", "scale"))
trainTransformed = predict(preProcValues, datTrain)
testTransformed = predict(preProcValues, datTest)
## å°è£…æ³• rfe: Recursive feature selection ##
subsets = c(2, 5, 10, 15, 20)
# è¦é€‰æ‹©çš„å˜é‡ä¸ªæ•°
ctrl = rfeControl(functions = rfFuncs, method = "cv")
# é¦–å…ˆå®šä¹‰æ§åˆ¶å‚æ•°ï¼Œfunctionsæ˜¯ç¡®å®šç”¨ä»€ä¹ˆæ ·çš„æ¨¡å‹è¿›è¡Œè‡ªå˜é‡æ’åºï¼Œæœ¬ä¾‹é€‰æ‹©çš„æ¨¡å‹æ˜¯éšæœºæ£®æ—
# æ ¹æ®ç›®æ ‡å‡½æ•°ï¼ˆé€šå¸¸æ˜¯é¢„æµ‹æ•ˆæœè¯„åˆ†ï¼‰ï¼Œæ¯æ¬¡é€‰æ‹©è‹¥å¹²ç‰¹å¾ã€‚
# methodæ˜¯ç¡®å®šç”¨ä»€ä¹ˆæ ·çš„æŠ½æ ·æ–¹æ³•ï¼Œæœ¬ä¾‹ä½¿ç”¨cvï¼Œå³äº¤å‰æ£€éªŒ
x = trainTransformed [, -which( colnames(trainTransformed ) %in% "å†³å®š")]
y = trainTransformed [, "å†³å®š"]
library("e1071")
Profile = rfe(x,y,sizes = subsets, rfeControl = ctrl)
Profile$optVariables  # ç­›é€‰å‡º15ä¸ªå˜é‡
### 3.æ¨¡å‹è®­ç»ƒåŠè°ƒå‚ ###
dat.train = trainTransformed[, c(Profile$optVariables, "å†³å®š")]
dat.test = testTransformed[, c(Profile$optVariables, "å†³å®š")]
## éšæœºæ£®æ— ##
set.seed(1234)
gbmFit1 = train(å†³å®š ~., data = dat.train, method = "rf")
# ç”¨äºè®­ç»ƒæ¨¡å‹
importance = varImp(gbmFit1, scale = FALSE)
# å¾—åˆ°å„ä¸ªå˜é‡çš„é‡è¦æ€§
plot(importance, xlab = "é‡è¦æ€§")
### 4.æ¨¡å‹é¢„æµ‹åŠè¯„ä»· ###
data.predict = predict(gbmFit1, newdata = dat.test)
confusionMatrix(data.predict, dat.test$å†³å®š)
1+2
äº§ç”Ÿæ•°æ®æ¡†
###2.5. 3 é•¿å®½æ ¼å¼çš„è½¬æ¢
###1ï¼‰stack()å’Œ unstack()
xx01 <- data.frame(age=c(20,21,20,22,19),per=c(60,50,70,80,90))###äº§ç”Ÿæ•°æ®æ¡†
xx01
###2.5. 3 é•¿å®½æ ¼å¼çš„è½¬æ¢
###1ï¼‰stack()å’Œ unstack()
xx01 <- data.frame(age=c(20,21,20,22,19),per=c(60,50,70,80,90))###äº§ç”Ÿæ•°æ®æ¡†
xx01
###2.5. 3 é•¿å®½æ ¼å¼çš„è½¬æ¢
###1ï¼‰stack()å’Œ unstack()
xx01 <- data.frame(age=c(20,21,20,22,19),per=c(60,50,70,80,90))###äº§ç”Ÿæ•°æ®æ¡†
###2.5. 3 é•¿å®½æ ¼å¼çš„è½¬æ¢
###1ï¼‰stack()å’Œ unstack()
xx01 <- data.frame(age=c(20,21,20,22,19),per=c(60,50,70,80,90))###äº§ç”Ÿæ•°æ®æ¡†
xx01
xx02 <- stack(xx01) ###è½¬æ¢æˆé•¿æ•°æ®æ¡†
xx02
xx03 <- data.frame(stunames=c("ç‹ä¸€","å¼ äºŒ","é™ˆä¸‰","æå››","å­™å…­"),age=c(20,21,20,22,19),per=c(60,50,70,80,90)) ###äº§ç”Ÿæ•°æ®æ¡†
#3.1.1 å¾ªç¯æ‰§è¡Œç»“æ„
#1.for
x<-c(1,2,3,4,5)
for(n in x) print(n+1)
#2.while
x<-2
while(x<=15) x<-x+2 #å¦‚æœ x å°äºç­‰äº 15ï¼Œåˆ™å°† x+2 èµ‹å€¼ç»™ x
x
repeat{
x<-x+2
if(x>15) break #å¦‚æœ x å¤§äº 15 åˆ™è·³å‡ºå¾ªç¯
}
x
for(i in 1:x){
if(i == 5)next #å¦‚æœ x ç­‰äº 5 åˆ™è·³å‡ºå¾ªç¯
sum=sum+i
}
sum
for(i in 1:x){
if(i == 5)next #å¦‚æœ x ç­‰äº 5 åˆ™è·³å‡ºå¾ªç¯
sum=sum+i
}
sum<-0
for(i in 1:x){
if(i == 5)next #å¦‚æœ x ç­‰äº 5 åˆ™è·³å‡ºå¾ªç¯
sum=sum+i
}
sum
print(sum)
for(i in 1:x){
if(i == 5)next #å¦‚æœ x ç­‰äº 5 åˆ™è·³å‡ºå¾ªç¯
sum=sum+i
print(sum)
}
sum<-0
for(i in 1:x){
if(i == 5)next #å¦‚æœ x ç­‰äº 5 åˆ™è·³å‡ºå¾ªç¯
sum=sum+i
print(sum)
}
length(for(i in 1:x){
if(i == 5)next #å¦‚æœ x ç­‰äº 5 åˆ™è·³å‡ºå¾ªç¯
sum=sum+i
print(sum)
})
#3.1.2 æ¡ä»¶æ‰§è¡Œç»“æ„
x<-c(TRUE,FALSE,FALSE)
x
y<-c(TRUE,TRUE,FALSE)
y
x&&y #åªåˆ¤æ–­ç¬¬ä¸€ä¸ªå…ƒç´ 
x&y #åˆ¤æ–­å‘é‡é‡Œæ‰€æœ‰å…ƒç´ 
#if_else è¯­å¥
x<-1
y<-if(x>1) x else -x
y
#ç­‰åŒäºä¸‹é¢çš„ä»£ç 
if(x>1){
y <- x
} else{
y <- -x
}
y
#ifelse è¯­å¥
x<-1:3
y<-ifelse(x>1,x,-x)
y
#3.switch
for(i in c(-1:3, 9)) print(switch(i, 1, 2 , 3, 4))
stock<-c("600292","600116")
for(i in stock)
for(i in stock)
for(i in stock)
print(switch(i,"600292"="ä¹å·é¾™ç”µ" ,
"600116"="ä¸‰å³¡æ°´åˆ©" ,
"600452"="æ¶ªé™µç”µåŠ›" ,
"600098"="å¹¿å·æ§è‚¡" ,
"601991"="å¤§å”å‘ç”µ" ,
"000958"="ä¸œæ–¹çƒ­ç”µ"
)
)
print(switch(i,"600292"="ä¹å·é¾™ç”µ" ,
"600116"="ä¸‰å³¡æ°´åˆ©" ,
"600452"="æ¶ªé™µç”µåŠ›" ,
"600098"="å¹¿å·æ§è‚¡" ,
"601991"="å¤§å”å‘ç”µ" ,
"000958"="ä¸œæ–¹çƒ­ç”µ"
)
)}
print(switch(i,"600292"="ä¹å·é¾™ç”µ" ,
"600116"="ä¸‰å³¡æ°´åˆ©" ,
"600452"="æ¶ªé™µç”µåŠ›" ,
"600098"="å¹¿å·æ§è‚¡" ,
"601991"="å¤§å”å‘ç”µ" ,
"000958"="ä¸œæ–¹çƒ­ç”µ"
)
)}
print(switch(i,"600292"="ä¹å·é¾™ç”µ" ,
"600116"="ä¸‰å³¡æ°´åˆ©" ,
"600452"="æ¶ªé™µç”µåŠ›" ,
"600098"="å¹¿å·æ§è‚¡" ,
"601991"="å¤§å”å‘ç”µ" ,
"000958"="ä¸œæ–¹çƒ­ç”µ"))}
for(i in stock){
print(switch(i,"600292"="ä¹å·é¾™ç”µ" ,
"600116"="ä¸‰å³¡æ°´åˆ©" ,
"600452"="æ¶ªé™µç”µåŠ›" ,
"600098"="å¹¿å·æ§è‚¡" ,
"601991"="å¤§å”å‘ç”µ" ,
"000958"="ä¸œæ–¹çƒ­ç”µ"
))
}
setwd("C:\\Users\\terry\\Documents\\æˆ‘çˆ±å­¦ä¹ \\ç»Ÿè®¡è½¯ä»¶\\R\\Rè„šæœ¬\\Rè¯­è¨€é‡‘èåˆ†æ")
